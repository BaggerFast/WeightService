@using Pl.Admin.Client.Source.Shared.Api.Web.Endpoints
@using Pl.Admin.Client.Source.Shared.Constants
@using Blazor.Heroicons.Outline

@attribute [Route(Urls.Arms + "/{Id:guid}")]

<UseEndpoint
  Endpoint="@DevicesEndpoints.ArmEndpoint"
  Arg="@Id"
  Context="armQuery"
>
  <div class="w-full">
    <Breadcrumbs>
      <Breadcrumb Label="Линия" Link="@Urls.Arms" />
      @if (armQuery.HasData)
      {
        <Breadcrumb Label="@armQuery.Data.Name" />
      }
    </Breadcrumbs>
    <div class="w-full border-b">
      <div class="py-2 flex w-full justify-between items-center">
        @if (armQuery.HasData)
        {
          <div class="flex gap-2 items-center">
            <h2 class="font-bold text-3xl truncate tracking-tight">@armQuery.Data.Name</h2>
            <div class="@Css.Class("size-4 rounded-full overflow-hidden", (DateTime.Now - armQuery.Data.ChangeDt).TotalMinutes < 5 ? "bg-green-500" : "bg-muted-foreground")"></div>
          </div>
          }
          else
          {
            <Skeleton Class="h-8 w-40"/>
          }
            <div class="flex gap-2">
              <Button Variant="ButtonVariantType.Outline">
                <PencilIcon class="size-4 mr-2"/>
                <span>Изменить</span>
              </Button>
              <Button Variant="ButtonVariantType.Destructive">
                <TrashIcon class="size-4 mr-2"/>
                <span>Удалить</span>
              </Button>
            </div>
          </div>
      <div class="flex gap-6">
        <ViewTabButton Value="info" @bind-CurrentTab="CurrentTab">
          Информация
        </ViewTabButton>
        <ViewTabButton Value="plus" @bind-CurrentTab="CurrentTab">
          ПЛУ
        </ViewTabButton>
        <ViewTabButton Value="labels" @bind-CurrentTab="CurrentTab">
          Этикетки
        </ViewTabButton>
        <ViewTabButton Value="pallets" @bind-CurrentTab="CurrentTab">
          Паллеты
        </ViewTabButton>
        <ViewTabButton Value="analytics" @bind-CurrentTab="CurrentTab">
          Аналитика
        </ViewTabButton>
      </div>
    </div>
    <div class="flex flex-col w-full pt-4">
      <Tabs @bind-ActiveTabId="@CurrentTab">
        @if (armQuery.HasData)
        {
          <Tab Id="info">
            <ArmViewInfo Arm="@armQuery.Data"/>
          </Tab>
          <Tab Id="analytics">
            <ArmViewAnalytics Arm="@armQuery.Data" />
          </Tab>
          <Tab Id="labels">
            <ArmViewLabels Arm="@armQuery.Data" />
          </Tab>
          <Tab Id="pallets">
            <ArmViewPallets Arm="@armQuery.Data" />
          </Tab>
          <Tab Id="plus">
            <ArmViewPlu Arm="@armQuery.Data" />
          </Tab>
        }
        else
        {
          <Spinner Class="inline size-32 text-muted-foreground animate-spin fill-primary mx-auto py-20" />
        }
      </Tabs>
    </div>
  </div>
</UseEndpoint>



@code {
  [Inject] private DevicesEndpoints DevicesEndpoints { get; set; } = default!;
  [Parameter] public Guid Id { get; set; }

  private string CurrentTab { get; set; } = "info";
}