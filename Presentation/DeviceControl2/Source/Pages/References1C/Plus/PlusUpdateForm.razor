@using DeviceControl2.Source.Widgets.Section
@using DeviceControl2.Source.Widgets.Section.FormActions
@using DeviceControl2.Source.Widgets.Section.FormFields
@using Ws.Domain.Models.Entities.Ref

@inherits SectionFormBase<Ws.Domain.Models.Entities.Ref1c.PluEntity>

<SectionForm
  FormModel="@DialogItem"
  ChangeDate="DialogItem.ChangeDt"
  CreateDate="DialogItem.CreateDt"
  Validator="@(new PlusUpdateFormValidator())"
  OnCancelAction="@OnCancelAction"
  OnSubmitAction="@UpdateItem"
>
  <FieldsContent>
    <SectionGuidField Value="@DialogItem.Uid" />

    <SectionReadOnlyField
      Label="1C UID"
      Value="@DialogItem.Uid1C"
      IsCopyable
    />

    <SectionReadOnlyField
      Label="Номер"
      Value="@DialogItem.Number"
    />

    <SectionReadOnlyField
      Label="Тип"
      Value="@GetPluTypeName(DialogItem.IsCheckWeight)"
    />

    <SectionReadOnlyField
      Label="Срок годности"
      Value="@DialogItem.ShelfLifeDays"
    />

    <SectionTextField
      Label="Название"
      @bind-Value="@DialogItem.Name"
      For="@(() => DialogItem.Name)"
      Disabled="@(!IsForceSubmit)"
    />

    <SectionReadOnlyField
      Label="Пакет"
      Value="@DialogItem.Bundle.Name"
      Path="@Redirector.ToPath(DialogItem.Bundle)"
    />

    <SectionReadOnlyField
      Label="Клипса"
      Value="@DialogItem.Clip.Name"
      Path="@Redirector.ToPath(DialogItem.Clip)"
    />

    <SectionReadOnlyField
      Label="Бренд"
      Value="@DialogItem.Brand.Name"
      Path="@Redirector.ToPath(DialogItem.Brand)"
    />

    <SectionReadOnlyField
      Label="Способ хранения"
      Value="@DialogItem.StorageMethod.Name"
      Path="@Redirector.ToPath(DialogItem.StorageMethod, User)"
    />

    <SectionSelectSingleField
      TItem="TemplateEntity"
      Label="Шаблон"
      Items="AllTemplates"
      @bind-Value="Template"
      ItemDisplayName="@(item => item.Name)"
      Disabled="@(!IsForceSubmit)"
      Path="@Redirector.ToPath(Template, User)"
    />

    <SectionReadOnlyField
      Label="Ean13"
      Value="@DialogItem.Ean13"
    />

    <SectionReadOnlyField
      Label="Gtin"
      Value="@DialogItem.Gtin"
    />

    <SectionReadOnlyField
      Label="Itf14"
      Value="@DialogItem.Itf14"
    />

    <SectionTextAreaField
      Label="Полное название"
      @bind-Value="@DialogItem.FullName"
      For="@(() => DialogItem.FullName)"
      Disabled="@(!IsForceSubmit)"
    />

    <SectionTextAreaField
      Label="Описание"
      @bind-Value="@DialogItem.Description"
      For="@(() => DialogItem.Description)"
      Disabled="@(!IsForceSubmit)"
    />
  </FieldsContent>
  <ActionsContent>
    <SectionFormActionShare Path="@($"{RouteUtils.SectionPlus}/{DialogItem.Uid}")" />
    <SectionFormActionUnlock @bind-IsUnlocked="@IsForceSubmit" />
    @if (IsForceSubmit)
    {
      <SectionFormActionReset OnClick="@ResetAction" />
    }
  </ActionsContent>
</SectionForm>
